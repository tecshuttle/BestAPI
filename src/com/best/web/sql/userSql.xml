<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="userSql">


    <!-- 家庭成员 -->

    <select id="findFamilyList" resultType="User">
		select * from USERS
	</select>

    <select id="findFamilyBaseInfoList" parameterType="String" resultType="FamilyBaseInfo">
		select id,name,familyType
		 from  (select a.id ,a.cust_name name,'SELF' familyType,create_date
		          from v_bd_cust a
		         where id = #{id}
		         union all
				 select id,name,'FAMILY' familyType,create_date
		          from xzh_cust_family
		         where cust_id = #{id}
		           and active_flag = '1'
			   )
		 order by create_date
		
	</select>

    <select id="findFamilyById" parameterType="String" resultType="Family">
		select id,cust_id id,name, name, password,
   			   cret_type cretType, cret_no cretNo, insurance_type insuranceType, 
   			   insurance_no insuranceNo, mobile, marriage
		  from xzh_cust_family
		 where id = #{id} and active_flag = '1'
	</select>

    <insert id="insertFamily" parameterType="Family">
		insert into xzh_cust_family 
		(
			id, creator, create_date,active_flag,
		   	cust_id, name, name,
		   	password, cret_type, cret_no,
		   	insurance_type, insurance_no, mobile, 
		   	marriage
		) 
		values 
		( 
			#{id}, null, sysdate,'1',
		   	#{id}, #{name}, #{name},
		   	to_date(#{password},'yyyy/MM/dd'), #{cretType}, #{cretNo},
		   	#{insuranceType}, #{insuranceNo}, #{mobile}, 
		   	#{marriage}
		)
	</insert>

    <update id="updateFamily" parameterType="Family">
		update xzh_cust_family
		   set id = #{id},
		       modifier = null,
		       modify_date = sysdate,
		       name = #{name},
		       name = #{name},
		       password = to_date(#{password},'yyyy/MM/dd'),
		       cret_type = #{cretType},
		       cret_no = #{cretNo},
		       insurance_type = #{insuranceType},
		       insurance_no = #{insuranceNo},
		       mobile = #{mobile},
		       marriage = #{marriage}
		 where id = #{id}
	</update>

    <update id="deleteFamily">
		update xzh_cust_family
		   set modifier = null,
		       modify_date = sysdate,
		       active_flag = '0'
		 where id = #{id}
	</update>
</mapper>